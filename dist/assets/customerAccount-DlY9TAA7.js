var y=Object.defineProperty;var S=(i,e,t)=>e in i?y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var h=(i,e,t)=>S(i,typeof e!="symbol"?e+"":e,t);import{_ as g}from"./index-BNPBOLjl.js";const f={minLength:8,blacklistedPasswords:["password","123456","qwerty","abc123","password123"]},b=["What was the name of your first pet?","What is your mother's maiden name?","What city were you born in?","What was the name of your elementary school?","What is your favorite movie?","What was your childhood nickname?","What is the name of the street you grew up on?","What was your first car's make and model?"],u={validateEmail(i){const e=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;return i?e.test(i)?i.length>254?{isValid:!1,error:"Email address is too long"}:{isValid:!0}:{isValid:!1,error:"Please enter a valid email address"}:{isValid:!1,error:"Email is required"}},validatePassword(i){const e=[];return i?(i.length<f.minLength&&e.push(`Password must be at least ${f.minLength} characters long`),/[A-Z]/.test(i)||e.push("Password must contain at least one uppercase letter"),/[a-z]/.test(i)||e.push("Password must contain at least one lowercase letter"),/\d/.test(i)||e.push("Password must contain at least one number"),f.blacklistedPasswords.includes(i.toLowerCase())&&e.push("This password is too common. Please choose a stronger password"),{isValid:e.length===0,errors:e}):(e.push("Password is required"),{isValid:!1,errors:e})},validatePhone(i){const e=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;return i?i.replace(/\D/g,"").length!==10?{isValid:!1,error:"Phone number must be 10 digits"}:e.test(i)?{isValid:!0}:{isValid:!1,error:"Please enter a valid phone number (e.g., (555) 123-4567)"}:{isValid:!1,error:"Phone number is required"}},validateSecurityAnswer(i){return!i||i.trim().length<3?{isValid:!1,error:"Security answer must be at least 3 characters"}:i.trim().length>100?{isValid:!1,error:"Security answer is too long"}:{isValid:!0}}},m={async hashPassword(i){const t=new TextEncoder().encode(`${i}vip_salt_2024`),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(o=>o.toString(16).padStart(2,"0")).join("")},async verifyPassword(i,e){return await m.hashPassword(i)===e}},d=class d{constructor(){h(this,"currentCustomer",null)}static getInstance(){return d.instance||(d.instance=new d),d.instance}async login(e,t){try{const s=u.validateEmail(e);if(!s.isValid)throw new Error(s.error||"Invalid email");const o=this.getStoredCustomers().find(a=>a.email.toLowerCase()===e.toLowerCase());if(o!=null&&o.hashedPassword&&await m.verifyPassword(t,o.hashedPassword)){o.lastLogin=new Date().toISOString(),this.updateStoredCustomer(o);const n=this.generateToken();return localStorage.setItem("vip_customer_token",n),localStorage.setItem("vip_current_customer",JSON.stringify(o)),this.currentCustomer=o,o}throw new Error("Invalid email or password")}catch(s){throw console.error("Login error:",s),s}}async register(e){try{const t=this.validateRegistrationData(e);if(!t.isValid)throw new Error(t.errors.join(". "));const s=this.getStoredCustomers();if(s.some(c=>c.email.toLowerCase()===e.email.toLowerCase()))throw new Error("An account with this email already exists");const o=await m.hashPassword(e.password),a={id:`customer_${Date.now()}_${Math.random().toString(36).substring(2)}`,email:e.email.toLowerCase(),firstName:e.firstName.trim(),lastName:e.lastName.trim(),phone:this.formatPhoneNumber(e.phone),address:e.address.trim(),city:e.city.trim(),state:e.state.trim(),zipCode:e.zipCode.trim(),serviceArea:e.serviceArea,hashedPassword:o,securityQuestion:e.securityQuestion,securityAnswer:e.securityAnswer.toLowerCase().trim(),createdAt:new Date().toISOString(),isActive:!0,emailVerified:!1,lastLogin:new Date().toISOString()};s.push(a),localStorage.setItem("vip_customers",JSON.stringify(s));const n=this.generateToken();localStorage.setItem("vip_customer_token",n),localStorage.setItem("vip_current_customer",JSON.stringify(a)),this.currentCustomer=a,await this.sendWelcomeEmail(a);const{NotificationService:l}=await g(async()=>{const{NotificationService:c}=await import("./notifications-BzgrSx2V.js");return{NotificationService:c}},[]);return l.createWelcomeNotification(a.id,a.firstName),a}catch(t){throw console.error("Registration error:",t),t}}async resetPassword(e){try{const t=u.validateEmail(e);if(!t.isValid)return{success:!1,message:t.error||"Invalid email"};if(!this.getStoredCustomers().find(l=>l.email.toLowerCase()===e.toLowerCase()))return{success:!0,message:"If an account with this email exists, password reset instructions have been sent."};const o=this.generateResetToken(),a={email:e.toLowerCase(),token:o,expiresAt:new Date(Date.now()+60*60*1e3).toISOString(),used:!1},n=this.getStoredResetRequests();return n.push(a),localStorage.setItem("vip_reset_requests",JSON.stringify(n)),console.log("Password reset token:",o),console.log(`Reset link would be: /reset-password?token=${o}`),{success:!0,message:"Password reset instructions have been sent to your email."}}catch(t){return console.error("Password reset error:",t),{success:!1,message:"Failed to process password reset request"}}}async resetPasswordWithToken(e,t){try{const s=u.validatePassword(t);if(!s.isValid)return{success:!1,message:s.errors.join(". ")};const r=this.getStoredResetRequests(),o=r.find(c=>c.token===e&&!c.used);if(!o)return{success:!1,message:"Invalid or expired reset token"};if(new Date(o.expiresAt)<new Date)return{success:!1,message:"Reset token has expired"};const a=this.getStoredCustomers(),n=a.findIndex(c=>c.email===o.email);if(n===-1)return{success:!1,message:"Customer not found"};const l=await m.hashPassword(t);return a[n].hashedPassword=l,localStorage.setItem("vip_customers",JSON.stringify(a)),o.used=!0,localStorage.setItem("vip_reset_requests",JSON.stringify(r)),{success:!0,message:"Password has been reset successfully"}}catch(s){return console.error("Password reset with token error:",s),{success:!1,message:"Failed to reset password"}}}async resetPasswordWithSecurity(e,t,s){try{const r=u.validateEmail(e);if(!r.isValid)return{success:!1,message:r.error||"Invalid email"};const o=u.validatePassword(s);if(!o.isValid)return{success:!1,message:o.errors.join(". ")};const a=this.getStoredCustomers(),n=a.findIndex(w=>w.email.toLowerCase()===e.toLowerCase());if(n===-1)return{success:!1,message:"No account found with this email"};const l=a[n];if(!l.securityAnswer)return{success:!1,message:"No security question set for this account"};if(l.securityAnswer!==t.toLowerCase().trim())return{success:!1,message:"Incorrect security answer"};const c=await m.hashPassword(s);return a[n].hashedPassword=c,localStorage.setItem("vip_customers",JSON.stringify(a)),{success:!0,message:"Password has been reset successfully"}}catch(r){return console.error("Security question password reset error:",r),{success:!1,message:"Failed to reset password"}}}getCurrentCustomer(){if(this.currentCustomer)return this.currentCustomer;const e=localStorage.getItem("vip_customer_token"),t=localStorage.getItem("vip_current_customer");if(e&&t)try{const s=JSON.parse(t);return this.currentCustomer=s,s}catch{this.logout()}return null}logout(){this.currentCustomer=null,localStorage.removeItem("vip_customer_token"),localStorage.removeItem("vip_current_customer")}async validateToken(){const e=localStorage.getItem("vip_customer_token"),t=localStorage.getItem("vip_current_customer");if(e&&t)try{return JSON.parse(t),!0}catch{return this.logout(),!1}return!1}validateRegistrationData(e){const t=[],s=u.validateEmail(e.email);s.isValid||t.push(s.error||"Invalid email");const r=u.validatePassword(e.password);r.isValid||t.push(...r.errors),e.password!==e.confirmPassword&&t.push("Passwords do not match");const o=u.validatePhone(e.phone);o.isValid||t.push(o.error||"Invalid phone"),e.firstName.trim()||t.push("First name is required"),e.lastName.trim()||t.push("Last name is required"),e.address.trim()||t.push("Address is required"),e.city.trim()||t.push("City is required"),e.state.trim()||t.push("State/Province is required"),e.zipCode.trim()||t.push("Postal/ZIP code is required"),e.serviceArea||t.push("Service area is required"),e.securityQuestion||t.push("Security question is required");const a=u.validateSecurityAnswer(e.securityAnswer);return a.isValid||t.push(a.error||"Invalid security answer"),{isValid:t.length===0,errors:t}}getStoredCustomers(){try{const e=localStorage.getItem("vip_customers");return e?JSON.parse(e):[]}catch{return[]}}getStoredResetRequests(){try{const e=localStorage.getItem("vip_reset_requests");return e?JSON.parse(e):[]}catch{return[]}}updateStoredCustomer(e){const t=this.getStoredCustomers(),s=t.findIndex(r=>r.id===e.id);s!==-1&&(t[s]=e,localStorage.setItem("vip_customers",JSON.stringify(t)))}generateToken(){return`customer_token_${Date.now()}_${Math.random().toString(36).substring(2)}`}generateResetToken(){return`reset_${Date.now()}_${Math.random().toString(36).substring(2)}`}formatPhoneNumber(e){const s=e.replace(/\D/g,"").match(/^(\d{3})(\d{3})(\d{4})$/);return s?`(${s[1]}) ${s[2]}-${s[3]}`:e}async sendWelcomeEmail(e){try{const t=(await g(async()=>{const{default:r}=await import("./index-DttXfGgZ.js");return{default:r}},[])).default,s={to_name:`${e.firstName} ${e.lastName}`,to_email:e.email,customer_name:e.firstName,customer_id:e.id,service_area:e.serviceArea,phone:e.phone,login_url:`${window.location.origin}/?page=dashboard`,website_url:window.location.origin,support_phone:"(289) 697-6559",support_email:"info@vipcleaningsquad.ca"};await t.send("vip_cleaning_service","welcome_template",s,"your_public_key"),console.log("Welcome email sent successfully to:",e.email)}catch(t){console.error("Failed to send welcome email:",t)}}};h(d,"instance");let p=d;class I{async getCustomerSubscriptions(e){try{const t=localStorage.getItem("vip_subscriptions");return(t?JSON.parse(t):[]).filter(r=>r.customerId===e||r.customerEmail===this.getCustomerEmail(e))}catch{return[]}}async getAllSubscriptions(){try{const e=localStorage.getItem("vip_subscriptions");return e?JSON.parse(e):[]}catch{return[]}}async pauseSubscription(e,t){try{const s=await this.getAllSubscriptions(),r=s.findIndex(o=>o.id===e);return r!==-1?(s[r].status="paused",s[r].pausedUntil=t,s[r].updatedAt=new Date().toISOString(),localStorage.setItem("vip_subscriptions",JSON.stringify(s)),console.log(`Pausing subscription ${e} until ${t||"indefinitely"}`),!0):!1}catch(s){return console.error("Error pausing subscription:",s),!1}}async resumeSubscription(e){try{const t=await this.getAllSubscriptions(),s=t.findIndex(r=>r.id===e);if(s!==-1){t[s].status="active",t[s].pausedUntil=void 0,t[s].updatedAt=new Date().toISOString();const r=new Date,o=t[s].frequency;return o==="weekly"?r.setDate(r.getDate()+7):o==="biweekly"?r.setDate(r.getDate()+14):o==="monthly"&&r.setMonth(r.getMonth()+1),t[s].nextBillingDate=r.toISOString(),localStorage.setItem("vip_subscriptions",JSON.stringify(t)),console.log(`Resuming subscription ${e}`),!0}return!1}catch(t){return console.error("Error resuming subscription:",t),!1}}async cancelSubscription(e,t){try{const s=await this.getAllSubscriptions(),r=s.findIndex(o=>o.id===e);return r!==-1?(s[r].status="cancelled",s[r].cancellationReason=t,s[r].updatedAt=new Date().toISOString(),localStorage.setItem("vip_subscriptions",JSON.stringify(s)),console.log(`Cancelling subscription ${e}. Reason: ${t}`),!0):!1}catch(s){return console.error("Error cancelling subscription:",s),!1}}async updateSubscriptionFrequency(e,t){try{const s=await this.getAllSubscriptions(),r=s.findIndex(o=>o.id===e);if(r!==-1){s[r].frequency=t,s[r].updatedAt=new Date().toISOString();const o=new Date;return t==="weekly"?o.setDate(o.getDate()+7):t==="biweekly"?o.setDate(o.getDate()+14):t==="monthly"&&o.setMonth(o.getMonth()+1),s[r].nextBillingDate=o.toISOString(),localStorage.setItem("vip_subscriptions",JSON.stringify(s)),console.log(`Updated subscription ${e} frequency to ${t}`),!0}return!1}catch(s){return console.error("Error updating subscription frequency:",s),!1}}async getSubscriptionById(e){try{return(await this.getAllSubscriptions()).find(s=>s.id===e)||null}catch{return null}}getCustomerEmail(e){try{const s=JSON.parse(localStorage.getItem("vip_customers")||"[]").find(r=>r.id===e);return(s==null?void 0:s.email)||""}catch{return""}}async getSubscriptionStats(){try{const e=await this.getAllSubscriptions(),t={total:e.length,active:e.filter(s=>s.status==="active").length,paused:e.filter(s=>s.status==="paused").length,cancelled:e.filter(s=>s.status==="cancelled").length,monthlyRecurringRevenue:0,weeklyRecurringRevenue:0};for(const s of e.filter(r=>r.status==="active"))s.frequency==="monthly"?t.monthlyRecurringRevenue+=s.amount:s.frequency==="weekly"?(t.weeklyRecurringRevenue+=s.amount,t.monthlyRecurringRevenue+=s.amount*4.33):s.frequency==="biweekly"&&(t.weeklyRecurringRevenue+=s.amount/2,t.monthlyRecurringRevenue+=s.amount*2.17);return t}catch{return{total:0,active:0,paused:0,cancelled:0,monthlyRecurringRevenue:0,weeklyRecurringRevenue:0}}}}class P{async getCustomerPayments(e){return[]}}class C{async getCustomerServiceHistory(e){return[]}}export{p as C,P,b as S,u as V,I as a,C as b};
